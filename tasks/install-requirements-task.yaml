apiVersion: tekton.dev/v1
kind: Task
metadata:
  name: install-requirements
spec:
  params:
    - name: repo-dir
      type: string
      default: app
  results:
    - name: venv-path
      description: Chemin absolu du venv
  workspaces:
    - name: source
  steps:
    - name: install
      image: python:3.12-slim
      workingDir: $(workspaces.source.path)
      script: |
        #!/usr/bin/env sh
        set -eu
        python -m venv .venv
        ./.venv/bin/pip install --upgrade pip
        ./.venv/bin/pip install -r "$(params.repo-dir)/requirements.txt"
        printf "%s" "$(pwd)/.venv" > "$(results.venv-path.path)"

